<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Quizmaster Control</title>
  <link href="https://fonts.googleapis.com/css2?family=Irish+Grover&display=swap" rel="stylesheet">
  <style>
    body { font-family:'Irish Grover', cursive; background:#222; color:#fff; padding:20px; margin:0; }
    h1 { font-size:2.5rem; text-align:center; }
    label { display:block; margin-top:15px; font-size:1.3rem; }
    select, input[type=text] { 
      padding:10px; font-size:1.1rem; width:100%; margin-top:5px; 
      border:none; border-radius:6px;
    }
    button { 
      margin-top:15px; padding:10px 20px; font-size:1.2rem; 
      background:#444; color:#fff; border:none; cursor:pointer; 
      border-radius:6px; width:100%;
    }
    button:hover { background:#666; }
    #modeToggle, #questionsList, #newQuestionForm, #participantsForm { 
      margin-top:20px; background:#333; padding:15px; border-radius:8px; 
    }
    .container { display:flex; flex-direction:row; gap:20px; flex-wrap:wrap; }
    .panel { flex:1; min-width:280px; }
    #newQuestionForm h2, #participantsForm h2 { font-size:1.8rem; text-align:center; }
    @media (max-width:768px) {
      h1 { font-size:2rem; }
      label { font-size:1.1rem; }
      button { font-size:1.1rem; }
      .container { flex-direction:column; }
    }
  </style>
</head>
<body>
  <h1>Quizmaster Control</h1>
  
  <div class="container">
    <!-- Mode Panel -->
    <div class="panel" id="modeToggle">
      <label for="mode">Mode:</label>
      <select id="mode">
        <option value="normal">Normal</option>
        <option value="balanced">Balanced</option>
      </select>
      <button id="applyMode">Apply Mode</button>
    </div>

    <!-- Questions Panel -->
    <div class="panel" id="questionsList">
      <label for="questionSelect">Select Question:</label>
      <select id="questionSelect"></select>
      <button id="activateQuestion">Activate Question</button>
      <button id="deactivateQuestion">Deactivate Question</button>
    </div>
  </div>

  <!-- Add Question -->
  <div id="newQuestionForm">
    <h2>Add New Question</h2>
    <label for="newQuestionText">Question Text:</label>
    <input type="text" id="newQuestionText" placeholder="Enter question text">
    <label for="newOptions">Options (comma separated):</label>
    <input type="text" id="newOptions" placeholder="Option1, Option2, Option3, Option4">
    <button id="addQuestion">Add Question</button>
  </div>

  <!-- Add Participants -->
  <div id="participantsForm">
    <h2>Manage Participants</h2>
    <label for="newParticipant">Add New Participant:</label>
    <input type="text" id="newParticipant" placeholder="Enter participant name">
    <button id="addParticipant">Add Participant</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
    import { getFirestore, collection, doc, getDocs, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCrlqToml9ZFFNZ0zZ7vXes-uR2i66iEcM",
      authDomain: "testhost-bf3fe.firebaseapp.com",
      projectId: "testhost-bf3fe",
      storageBucket: "testhost-bf3fe.firebasestorage.app",
      messagingSenderId: "1090261600630",
      appId: "1:1090261600630:web:44017d7a1b0fddd3a99257"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const modeSelect = document.getElementById('mode');
    const applyModeBtn = document.getElementById('applyMode');
    const questionSelect = document.getElementById('questionSelect');
    const activateBtn = document.getElementById('activateQuestion');
    const deactivateBtn = document.getElementById('deactivateQuestion');
    const addQuestionBtn = document.getElementById('addQuestion');
    const addParticipantBtn = document.getElementById('addParticipant');

    async function loadQuestions() {
      const qs = await getDocs(collection(db, "questions", "all", "list"));
      questionSelect.innerHTML = '';
      qs.forEach(docSnap => {
        const opt = document.createElement('option');
        opt.value = docSnap.id;
        opt.textContent = docSnap.data().text;
        questionSelect.appendChild(opt);
      });
    }
    loadQuestions();

    applyModeBtn.onclick = async () => {
      const mode = modeSelect.value;
      await updateDoc(doc(db,"questions","current"), { mode: mode });
      alert("Mode updated to " + mode);
    };

    activateBtn.onclick = async () => {
      const qId = questionSelect.value;
      await updateDoc(doc(db,"questions","current"), { active: true, questionId: qId });
      alert("Activated question: " + qId);
    };

    deactivateBtn.onclick = async () => {
      await updateDoc(doc(db,"questions","current"), { active: false });
      alert("Question deactivated");
    };

    addQuestionBtn.onclick = async () => {
      const text = document.getElementById('newQuestionText').value.trim();
      const options = document.getElementById('newOptions').value.split(',').map(o => o.trim()).filter(o => o);
      if (!text || options.length < 2) {
        alert("Enter question and at least 2 options");
        return;
      }
      const newQRef = doc(collection(db,"questions","all","list"));
      await setDoc(newQRef, { text: text, options: options });
      alert("Added new question");
      loadQuestions();
    };

    addParticipantBtn.onclick = async () => {
      const name = document.getElementById('newParticipant').value.trim();
      if (!name) {
        alert("Enter a valid participant name");
        return;
      }
      const newPRef = doc(db,"participants", name);
      await setDoc(newPRef, { name: name, isActive: true });
      alert("Added participant: " + name);
      document.getElementById('newParticipant').value = "";
    };
  </script>
</body>
</html>
